<!DOCTYPE html>
<html>
	<!-- 
		Sitio programado por Fernando Osorio (Fermoto5HD). 
		Repositorio del sitio: http://github.com/Fermoto5HD/proximo-tren 
	-->
	<head>
		<title>Próximo tren (beta)</title>
		<meta charset="utf-8" />
		<meta http-equiv="x-ua-compatible" content="ie=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
		<meta name="theme-color" content="rgb(20, 20, 20)" />
		<!-- Meta og -->
		<meta property="og:description" content='Consultá cuándo va a llegar el tren a la estación.'>
		<meta property="og:site_name" content="Próximo tren" />
		<meta property="og:title" content="Próximo tren" />
		<meta property="og:description" content='Consultá cuándo va a llegar el tren a la estación.' />
		<meta property="og:locale" content="es_AR" />
		<meta property="og:type" content="website" />
		<!-- Meta Twitter -->
		<meta name="twitter:title" content="Próximo tren" />
		<meta name="twitter:description" content='Consultá cuándo va a llegar el tren a la estación.' />
		<meta name="twitter:card" content="photo" />
		<meta name="twitter:site" content="@Fermoto5HD" />
		<meta name="twitter:creator" content="@Fermoto5HD" />

		<script src="vendor/jquery/jquery.min.js"></script>
		<script src="vendor/tether/tether.js"></script>
		<script src="vendor/bootstrap/bootstrap.min.js"></script>
		<link rel="stylesheet" href="vendor/bootstrap/bootstrap.min.css">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="css/style.css" />
		<script src="vendor/modernizr/modernizr.min.js"></script>
		<script src="vendor/jquery.marquee/jquery.marquee.min.js"></script>
		<script src="vendor/moment/moment-with-locales.min.js"></script>
		<script src="vendor/moment-duration-format/moment-duration-format.js"></script>
		<script src="js/scripts.js"></script>
	</head>
	<body class="dinpro">
		<div id="fondo"></div>
		<header>
			<nav class="navbar navbar-static-top navbar-dark bg-inverse">
				<div class="container">
					<span id="btn-back"></span>
					<a class="brand" id="OFSE" href="#home" title="Operadora Ferroviaria Sociedad del Estado"></a>
		            <button class="navbar-toggler hidden-sm-up pull-xs-right" type="button" data-toggle="collapse" data-target="#responsivemenu" style="font-family: inherit;"><i class="material-icons">menu</i></button>
						<ul class="nav navbar-nav pull-xs-right collapse navbar-toggleable-xs" id="responsivemenu" style="margin-left: 0px;">
							<li class="nav-item">
								<a class="nav-link" href="#" data-toggle="modal" data-target="#settings">Opciones</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#" data-toggle="modal" data-target="#about">Acerca de</a>
							</li>
						</ul>
				</div>
			</nav>
		</header>
		<script type="text/javascript">
			$('#options-nav a').click(function (e) {
				e.preventDefault()
				$(this).tab('show')
			})
		</script>
		<!-- Start options modal -->
		<div class="modal fade" id="settings" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content bg-inverse">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title">Opciones</h4>
					</div>
					<div class="modal-body">
						<!-- Nav tabs -->
						<ul class="nav nav-tabs" id="options-nav" role="tablist">
							<li class="nav-item">
								<a class="nav-link active" data-toggle="tab" href="#update-frequency" role="tab">Obtención de datos</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" data-toggle="tab" href="#appearance" role="tab">Apartado estético</a>
							</li>
						</ul>
						<!-- Tab panes -->
						<div class="tab-content">
							<div class="tab-pane fade in active" id="update-frequency" role="tabpanel">
								<br/>
								<h4>Frecuencia de actualización</h4>
								<p>Ajustá la frecuencia de actualización de los tiempos según el consumo de tus datos (en especial si lo usás en el celular).</p>
								<div class="list-group" id="frequencies">
									<a href="#" class="list-group-item" id="1000" onclick="updatefreq(1000)">
										<h4 class="list-group-item-heading">Tiempo real</h4>
										<p class="list-group-item-text">Segundo a segundo tenés los datos fresquitos.</p>
									</a>
									<a href="#" class="list-group-item" id="10000" onclick="updatefreq(10000)">
										<h4 class="list-group-item-heading">Cada 10 segundos</h4>
										<p class="list-group-item-text">Ideal para balancear entre datos precisos y ahorro de datos.</p>
									</a>
									<a href="#" class="list-group-item" id="20000" onclick="updatefreq(20000)">
										<h4 class="list-group-item-heading">Cada 20 segundos</h4>
										<p class="list-group-item-text">Ideal para los que quieren evitar gastar el prepago.</p>
									</a>
									<a href="#" class="list-group-item" id="none" onclick="updatefreq('none')">
										<h4 class="list-group-item-heading">Desactivado</h4>
										<p class="list-group-item-text">Si querés actualizar los datos cuando vos querés, esta es tu opción.</p>
									</a>
								</div>
							</div>
							<div class="tab-pane fade" id="appearance" role="tabpanel">
								<br/>
								<h4>Marca visible</h4>
								<p>¿Sos nostálgico? ¿Te gusta más la marca "Nuevos Ferrocarriles Argentinos" que la de "Operadora Ferroviaria"? Acá te doy la posibilidad de elegir entre esas dos marcas. ;) </p>
								<div class="btn-group" id="brands" data-toggle="buttons">
									<label class="btn btn-primary" id="OFSE">
										<input type="radio" name="brand" id="OFSE" autocomplete="off">Operadora Ferroviaria
									</label>
									<label class="btn btn-primary" id="NFA">
										<input type="radio" name="brand" id="NFA" autocomplete="off">Nuevos Ferrocarriles Argentinos
									</label>
								</div>
								<hr>
								<h4>Marca de las líneas</h4>
								<p>Lo mismo acá pero con las líneas ferroviarias. ¿Preferís las marcas anteriores o las actuales?</p>
								<div class="btn-group" id="linebrands" data-toggle="buttons">
									<label class="btn btn-primary" id="lines">
										<input type="radio" name="linebrands" id="lines" autocomplete="off">Actuales
									</label>
									<label class="btn btn-primary" id="lines-old">
										<input type="radio" name="linebrands" id="lines-old" autocomplete="off">Anteriores
									</label>
								</div>
								<hr>
								<h4>Fuente tipográfica</h4>
								<div class="btn-group" id="fonts" data-toggle="buttons">
									<label class="btn btn-primary" id="gotham">
										<input type="radio" name="font" id="gotham" autocomplete="off" checked>Gotham
									</label>
									<label class="btn btn-primary" id="dinpro">
										<input type="radio" name="font" id="dinpro" autocomplete="off">DIN Pro
									</label>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End options modal -->
		<!-- Start About modal -->
		<div class="modal fade" id="about" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content bg-inverse">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title">Acerca de "Próximo tren"</h4>
					</div>
					<div class="modal-body">
						<h3>Sobre la WebApp</h3>
						<div class="alert alert-warning">
							<strong>¡Atención!</strong>
							<p>Esta versión está en desarrollo. Pueden presentarse errores durante la ejecución. </p>
						</div>
						<p>Ante nada, gracias por utilizar la WebApp. </p>
						<p>Este es un proyecto basado en la webapp "Trenes en Vivo" del Ministerio de Transporte (antes Ministerio del Interior y Transporte"), juntando las tres distintas pantallas utilizadas en la red ferroviaria en una sóla y en forma de aplicación. Por supuesto, esta <strong>no es la aplicación oficial</strong>.</p>
						<p>Originalmente quería realizar una versión responsive de las pantallas de las estaciónes pero más tarde decidí juntar las otras y armar una webapp basada en Unsemantic (fork de 960gs con responsive). </p>
						<p>Junto a este proyecto estoy realizando "Viaje en vivo", el cual lo trabajo aparte de "Próximo tren" aunque ya lo estoy preparando para agregarlo y unificarlo con este proyecto. </p>
						<p>A partir de la versión v1.5 se utiliza el framework Bootstrap v4.0.0-alpha2 por su diversidad de componentes a utilizar. </p>
						<hr>
						<h3>Créditos y aclaraciones</h3>
						<p>La API de Trenes en Vivo es desarrollada por el Ministerio de Transporte de la Nación (antes Ministerio del Interior y Transporte de la Nación). Los créditos del desarrollo de dicha API van para los desarrolladores de la misma. Esta WebApp sólo realiza pedidos de información, no manipula ni altera la información generada por dicha API. </p>
						<p>Las imágenes utilizadas en los diferentes fondos de la webapp no son de mi autoría. </p>
						<p>Las marcas "Nuevos Ferrocarriles Argentinos", "Operadora Ferroviaria Sociedad del Estado", "Línea Sarmiento", "Línea Roca", "Línea Mitre", "Línea San Martín", "Línea Belgrano Sur" y "Tren de la Costa" pertenecen al Ministerio de Transporte de la Nación y a la Sociedad Operadora Ferroviaria Sociedad del Estado. </p>
						<p>El isologo de Metrovías pertenece a la empresa Metrovías S.A. </p>
						<p>El isologo de Ferrovías pertenece a la empresa Ferrovías S.A. </p>
						<p>El uso de las imágenes y marcas mencionadas en este apartado no pretenden perseguir beneficio monetario alguno. </p>
						<hr>
						<h3>CC BY 4.0 + Open Source</h3>
						<p>Como (casi) todos los proyectos que vengo llevando a cabo, el contenido de este proyecto, exceptuando los mencionados en "Créditos y aclaraciones", están bajo Creative Commons 4.0 Internacional. </p>
						<p>También está cargado en GitHub, podés forkearlo, reportar un issue o simplemente revisarlo por dentro. </p>
						<a class="btn btn-primary" href="http://github.com/Fermoto5HD/proximo-tren" target="_blank">GitHub</a>
						<hr>
						<p>¡Gracias por utilizar la webapp!</p>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End About modal -->
		<!-- Start First-time modal -->
		<div class="modal fade" id="first-time" tabindex="-1" role="dialog" data-backdrop="false" data-keyboard="false" style="background-color: rgba(0, 0, 0, 0.5)">
			<div class="modal-dialog" role="document">
				<div class="modal-content bg-inverse">
					<div class="modal-header">
						<h4 class="modal-title">¡Bienvenido!</h4>
					</div>
					<div class="modal-body">
						<p>Desde acá vas a poder saber el horario de partida de un tren, saber en cuánto tiempo llega el próximo tren a la estación y muy pronto realizar un seguimiento de tu tren en tiempo real.  </p>
						<p>En esta webapp podés tener la información en tiempo real, segundo a segundo. Pero, si estás muy preocupado por el consumo de los datos móviles (en caso de que estés en un área sin WiFi), podés hacer que los datos se actualicen cada 10 segundos, 20 segundos o directamente desactivarla y actualizar los datos en forma manual. </p>
						<p>Por defecto está configurado en "Tiempo real". Esto podés cambiarlo en cualquier momento en el apartado de opciones.</p>
						<hr>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End First-time modal -->
		<!-- Start soon modal -->
		<div class="modal fade" id="soon" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title">¡Muy pronto!</h4>
					</div>
					<div class="modal-body">
						<p>Próximamente podrás realizar el seguimiento de tu tren estación por estación. </p>
						<p>En una primera instancia estará disponible para usuarios del Sarmiento, San Martín y Tren de la Costa, y más adelante para las líneas Roca (sólo del ramal a La Plata) y toda la línea Mitre, dado a que la API general está limitada sólo a esas líneas. </p>
						<p>Se puede implementar para las demás líneas, pero tienden a fallar debido a la constante falta de precisión que tienen al momento de brindar los datos. </p>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End soon modal -->
		<!-- Loading modal -->
		<div class="modal fade" id="loading-section" tabindex="-1" role="dialog" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5)">
			<div class="modal-dialog" role="document">
				<div class="modal-content bg-inverse">
					<div class="modal-header">
						<h4 class="modal-title">Cargando...</h4>
					</div>
					<div class="modal-footer">
						<progress class="progress progress-striped progress-animated" value="100" max="100">Cargando...</progress>
					</div>
				</div>
			</div>
		</div>
		<!-- End Loading modal -->
		<!-- No connection -->
		<div id="no-connection" class="container" hidden>
			<div class="alert alert-danger">No tenés conexión a Internet. Por favor reintentá de nuevo cuando encuentres mejor señal o conexión WiFi.</div>
		</div>
		<!-- Sections will appear here -->
		<main id="main"></main>
		<script type="text/javascript">
			var JSONstations; 
			var mostrarHora = function(){
				var horaactual = moment().format("hh:mma"); 
				var strHoraActual = '<i class="material-icons">&#xE192;</i> ' + horaactual; 
				$('#horaactual').html(strHoraActual); 
				$('#horaactual-msj').html(strHoraActual); 
			}; 

			$(document).ready(function(){
				mostrarHora(); 
				setInterval(function(){mostrarHora();}, 60); 
			}); 

			var hs = moment().get('hour'); 
			var hsActuales = ""; 
			var fondo = "";  
			var fondoCheck = ""; 
			var horaFondo = function(){
				hs = moment().get('hour'); 

				fondo = "default.jpg"; 

				if ((hs >= 23) || (hs < 4)) {
					fondo = "noche1.jpg"; 
				} else if (hs < 6) {
					fondo = "madrugada.png"; 
				} else if (hs < 8) {
					fondo = "mañana0.jpg"; 
				} else if (hs < 11) {
					fondo = "mañana1.jpg"; 
				} else if (hs < 18) {
					fondo = "mediodia.jpg"; 
				} else if (hs < 20) {
					fondo = "tarde0.jpg";  
				} else if (hs < 21) {
					fondo = "tarde1.jpg"; 
				} else if (hs < 23) {
					fondo = "noche0.jpg"; 
				}; 

				if (hsActuales !== hs) {
					if ((hs < 7) || (hs > 21)) {
						$('head').append('<link rel="stylesheet" href="css/noche.css" type="text/css" />');
					} else {
						$('head').append('<link rel="stylesheet" href="css/mañana.css" type="text/css" />');
					}; 
					hsActuales = hs; 
					console.log('Estilo asignado'); 
					if (fondoCheck !== fondo) {
						$('#fondo').fadeTo('slow', 0.3, function()
						{
							$(this).css('background-image', 'url(img/background/'+fondo+')');
						}).fadeTo('slow', 1);
						fondoCheck = fondo; 
					};
				};
			}; 
			setInterval(function(){horaFondo(); }, 1000); 

			

			var type = window.location.hash.substr(1);
			var selector = false; 
			var paginaInicialVisible = false; 
			var timeout = null;

			$.getJSON( "data/stations.json", function(jsondata){
				JSONstations = jsondata; 
				if (type !== "") {
					$('main#cargando').css('display', 'block'); 
					var parts = type.split("&");
					var split1 = parts[0].split(':'); 
					var split2 = parts[1].split(':'); 

					if ((split1[0] === "ramal") && (split2[0] === "estacion")) {
						var ramalURL = parseInt(split1[1]); 
						var estacionURL = parseInt(split2[1]); 
						selector = true; 
						verifEstacion = true; 
						proximoTren(ramalURL, estacionURL); 
						setInterval(function() {proximoTren(ramalURL, estacionURL);}, 1500);
					}
					else if ((split1[0] === "estacion") && (split2[0] === "ramal")) {
						var estacionURL = parseInt(split1[1]); 
						var ramalURL = parseInt(split2[1]); 
						selector = true; 
						verifEstacion = true; 
						proximoTren(ramalURL, estacionURL); 
						setInterval(function() {proximoTren(ramalURL, estacionURL);}, 1500);
					} 
					else if ((split1[0] === "anden") && (split2[0] === "ramal")) {
						var anden = parseInt(split1[1]); 
						var ramal = parseInt(split2[1]); 
						verifAnden = true; 
						proximaSalida(); 
						setInterval(function() {proximaSalida();}, 1500);
					} 
					else if ((split1[0] === "ramal") && (split2[0] === "anden") ) {
						var ramal = parseInt(split1[1]); 
						var anden = parseInt(split2[1]); 
						verifAnden = true; 
						proximaSalida(); 
						setInterval(function() {proximaSalida();}, 1500);
					} 
					else{
						var ramalURL = 0; 
						var estacionURL = 0; 
						var cartel = 0; 
					};
					imgFooter(ramalURL); 
					$('.datos-estacion').css('display', 'block'); 
					$('main#main').css('display', 'none'); 
					selector = true; 
					paginaInicialVisible = false; 
				} else {
					selector = false; 
					paginaInicialVisible = true; 
					console.info('Cargando selector inicial'); 
					$('.datos-estacion').css('display', 'none'); 
					$('main#main').css('display', 'block'); 
					$('#btn-back').html('');
				};
			}).error(function(){
				console.error('Error with JSON'); 
			}); 
		</script>
	</body>
</html>